#!/bin/sh
echo -e "\033[0;32mAsking for sudo now so that it's not needed later\033[0m"
sudo echo -e "\033[0;32mOk\033[0m"
{{ if eq .chezmoi.osRelease.id "arch" -}}
  sudo pacman -S \
                  alacritty \
                  zsh \
                  btop \
                  neofetch \
                  exa \
                  git \
                  xclip \
                  blueman \
                  bluez \
                  unzip \
                  man-db \
                  wireguard-tools \
                  mpv \
                  mpv-mpris \
                  ripgrep \
                  fzf \
                  redshift \
                  fd \
                  zoxide \
                  zellij \
                  flameshot \
                  syncthing \

  # install paru
  sudo pacman -S --needed base-devel
  git clone https://aur.archlinux.org/paru.git ~/Desktop/paru
  cd ~/Desktop/paru
  makepkg -si

  # install paru packages
  paru -S clipit librewolf-bin ttf-ubuntu-mono-nerd emote

{{ else if eq .chezmoi.osRelease.id "nixos" -}}
  sudo mkdir /etc/nixos/git-repo
  sudo chown oscar /etc/nixos/git-repo
  nix-shell -p git --run "git clone git@github.com:Eldolfin/nixos-config.git /etc/nixos/git-repo"
  sudo mv -v /etc/nixos/configuration.nix /etc/nixos/configuration.nix.before-chezmoi-install
  sudo ln /etc/nixos/git-repo/configuration.nix /etc/nixos/configuration.nix
  sudo nixos-rebuild switch
{{ end -}}

# install oh my zsh
RUNZSH=no KEEP_ZSHRC=yes sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
# put back the zshrc
mv -v .zshrc.pre-oh-my-zsh .zshrc

# download backgrounds
echo -e "\033[0;32mDownloading backgrounds\033[0m"
git clone git@github.com:Eldolfin/windows_backgrounds.git .backgrounds

# download sounds
echo -e "\033[0;32mDownloading sounds\033[0m"
git clone git@github.com:Eldolfin/sounds.git Music/sounds

# install cargo toolchain
rustup default stable

# install sccache for faster rust compilation
echo -e "\033[0;32mInstalling sccache for faster rust compilation\033[0m"
mv ~/.cargo/config.toml ~/.cargo/config.toml.bak
{{ if eq .chezmoi.osRelease.id "nixos" -}}
nix-shell -p pkgconfig openssl --run "cargo install sccache"
{{ else -}}
cargo install sccache
{{ end -}}
mv ~/.cargo/config.toml.bak ~/.cargo/config.toml

# install nvim plugins
echo -e "\033[0;32mInstalling nvim plugins\033[0m"
nvim --headless +"\!sleep 1" +qall

# install atuin
echo -e "\033[0;32mSetting up atuin for shell history syncing\033[0m"
bash <(curl https://raw.githubusercontent.com/ellie/atuin/main/install.sh)


echo -e "\033[0;31mWhat's left TODO:\033[0m"
echo -e "\033[4;32mLogin on Atuin (\033[3;97matuin login\033[4;32m)\033[0m"
echo -e "\033[4;32mLogin and setup Syncthing\033[0m"
echo -e "\033[4;32m(Optional) Install nvim LSPs\033[0m"
